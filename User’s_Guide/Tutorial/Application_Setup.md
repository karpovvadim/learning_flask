Application Setup (Настройка приложения)

Приложение Flask является экземпляром класса Flask. Все, что касается приложения, например
конфигурация и URL-адреса, будет зарегистрировано в этом классе.

Самый простой способ создать приложение Flask — создать глобальный экземпляр Flask
непосредственно в верхней части вашего кода, например, как «Hello, World!» пример делал
на Project Layout. Несмотря на то, что в некоторых случаях это просто и полезно,
по мере роста проекта могут возникать некоторые сложности.

Вместо глобального создания экземпляра Flask вы создадите его внутри функции. Эта функция
известна как application factory (фабрика приложений). Любая конфигурация, регистрация и
другие настройки, необходимые приложению, будут происходить внутри функции, после чего
приложение будет возвращено.

The Application Factory (Фабрика приложений)

Пришло время начать кодирование! Создайте каталог flaskr, и добавьте файл __init__.py.
__init__.py выполняет двойную функцию: он будет содержать фабрику приложений и сообщает
Python, что каталог flaskr следует рассматривать как пакет.

$ mkdir flaskr
flaskr/__init__.py

create_app — это функция фабрики приложений. Вы добавите его позже в учебнике (tutorial),
но он уже многое делает.
     1. app = Flask(__name__, instance_relative_config=True) создает экземпляр Flask.
        * __name__ — это имя текущего модуля Python. Приложению необходимо знать, где оно
        находится, чтобы настроить некоторые пути, и __name__ — удобный способ сообщить
        ему об этом.
        * instance_relative_config=True сообщает приложению, что файлы конфигурации 
        относятся к папке экземпляра. Папка экземпляра находится за пределами пакета
        flaskr и может содержать локальные данные, которые не должны передаваться в
        систему контроля версий, такие как секреты конфигурации и файл базы данных.
     2. app.config.from_mapping() устанавливает некоторую конфигурацию по умолчанию,
        которую будет использовать приложение:
        * SECRET_KEY используется Flask и расширениями для обеспечения безопасности данных.
        Он установлен на «dev», чтобы обеспечить удобное значение во время разработки, но 
        его следует переопределить случайным значением при развертывании.
        * DATABASE — это путь, по которому будет сохранен файл базы данных SQLite. Он 
        находится в папке app.instance_path, которая является путем, выбранным Flask для
        папки экземпляра. Вы узнаете больше о базе данных в следующем разделе.
     3. app.config.from_pyfile() переопределяет конфигурацию по умолчанию значениями,
        взятыми из файла config.py в папке экземпляра, если он существует. Например, при
        развертывании это можно использовать для установки реального SECRET_KEY.
        * test_config также может быть передан фабрике и будет использоваться вместо
        конфигурации экземпляра. Это сделано для того, чтобы тесты, которые вы напишете
        позже в этом руководстве, можно было настроить независимо от любых настроенных 
        вами значений разработки.
     4. os.makedirs() гарантирует, что app.instance_path существует. Flask не создает 
        папку экземпляра автоматически, но ее необходимо создать, потому что ваш проект
        создаст там файл базы данных SQLite.
     5. @app.route() создает простой маршрут, чтобы вы могли увидеть, как работает
        приложение, прежде чем переходить к остальной части руководства. Он создает
        соединение между URL-адресом /hello и функцией, которая возвращает ответ, строку
        «Hello, World!» в этом случае.

Run The Application (Запустите приложение)

Теперь вы можете запустить свое приложение с помощью команды flask. В терминале сообщите
Flask, где найти ваше приложение, а затем запустите его в режиме отладки. Помните, что
вы по-прежнему должны находиться в каталоге flask-tutorial верхнего уровня, а не в
пакете flaskr.

Режим отладки показывает интерактивный отладчик всякий раз, когда страница вызывает
исключение, и перезапускает сервер всякий раз, когда вы вносите изменения в код.
Вы можете оставить его работающим и просто перезагрузить страницу браузера, следуя
инструкциям руководства.

$ flask --app flaskr --debug run

Вы увидите вывод, похожий на этот:

* Приложение для сервировочной фляги "flaskr"
* Режим отладки: включен
* Работает на http://127.0.0.1:5000/ (для выхода нажмите CTRL+C)
* Перезагрузка со статистикой
* Отладчик активен!
* PIN-код отладчика: nnn-nnn-nnn

Посетите http://127.0.0.1:5000/hello в браузере, и вы должны увидеть «Hello, World!» 
сообщение. Поздравляем, теперь вы запускаете свое веб-приложение Flask!

Если другая программа уже использует порт 5000, вы увидите OSError: [Errno 98] или 
OSError: [WinError 10013] при попытке запуска сервера. См. Address already in use 
(Адрес уже используется), чтобы узнать, как с этим справиться.
