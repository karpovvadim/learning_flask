Deploy to Production (Развертывание в производстве)

В этой части руководства предполагается, что у вас есть сервер, на котором вы хотите 
развернуть приложение. В нем дается обзор того, как создать файл дистрибутива и установить
его, но не будет вдаваться в подробности о том, какой сервер или программное обеспечение
использовать. Вы можете настроить новую среду на своем компьютере для разработки, чтобы
опробовать приведенные ниже инструкции, но, вероятно, не следует использовать ее для
размещения реального общедоступного приложения. См. Развертывание в рабочей среде для
получения списка различных способов размещения вашего приложения.

Build and Install (Сборка и установка)

Если вы хотите развернуть свое приложение в другом месте, вы создаете файл дистрибутива.
Текущим стандартом для дистрибутива Python является wheel format (формат колеса) с
расширением .whl. Сначала убедитесь, что библиотека колес установлена:

$ pip install wheel

Запуск setup.py с Python дает вам инструмент командной строки для выполнения команд,
связанных со сборкой. Команда bdist_wheel создаст файл дистрибутива колеса.

$ python setup.py bdist_wheel

Вы можете найти файл в dist/flaskr-1.0.0-py3-none-any.whl. Имя файла имеет формат 
{имя проекта}-{версия}-{тег python}-{тег abi}-{тег платформы}.

Скопируйте этот файл на другую машину, настройте новую виртуальную среду, затем установите
файл с помощью pip.

$ pip install flaskr-1.0.0-py3-none-any.whl

Pip установит ваш проект вместе с его зависимостями.
Поскольку это другой компьютер, вам нужно снова запустить init-db, чтобы создать базу данных
в папке экземпляра.

$ flask --app flaskr init-db

Когда Flask обнаруживает, что он установлен (не в редактируемом режиме), он использует другой
каталог для папки экземпляра. Вместо этого вы можете найти его в venv/var/flaskr-instance.

Configure the Secret Key (Настройте секретный ключ)

В начале урока вы указали значение по умолчанию для SECRET_KEY. Это должно быть изменено на
несколько случайных байтов в производстве. В противном случае злоумышленники могут
использовать открытый ключ «dev» для изменения файла cookie сеанса или чего-либо еще, 
использующего секретный ключ.
Вы можете использовать следующую команду для вывода случайного секретного ключа:

$ python -c 'import secrets; print(secrets.token_hex())'

'192b9bdd22ab9ed4d12e236c78afcb9a393ec15f71bbf5dc987d54727823bcbf'

Создайте файл config.py в папке экземпляра, из которого фабрика будет читать, если он 
существует. Скопируйте в него сгенерированное значение.

venv/var/flaskr-instance/config.py

SECRET_KEY = '192b9bdd22ab9ed4d12e236c78afcb9a393ec15f71bbf5dc987d54727823bcbf'

Вы также можете установить любую другую необходимую конфигурацию здесь, хотя SECRET_KEY —
единственная, необходимая для Flaskr.

Run with a Production Server (Запуск с производственным сервером)

При публичном запуске, а не в разработке, вы не должны использовать встроенный сервер 
разработки (запуск фляги). Сервер разработки предоставляется Werkzeug для удобства, но он не
рассчитан на то, чтобы быть особенно эффективным, стабильным или безопасным.
Вместо этого используйте рабочий сервер WSGI. Например, чтобы использовать Waitress 
(официантку), сначала установите ее в виртуальной среде:

$ pip install waitress

Вам нужно сообщить официантке о своем приложении, но оно не использует --app, как это делает
flask run. Вам нужно сказать ему импортировать и вызвать фабрику приложений, чтобы получить
объект приложения.

$ waitress-serve --call 'flaskr:create_app'

Serving on http://0.0.0.0:8080

См. Deploying to Production  (Развертывание в рабочей среде для получения списка различных
способов размещения вашего приложения. Официантка — это просто пример, выбранный для 
руководства, поскольку он поддерживает как Windows, так и Linux. Существует множество 
других серверов WSGI и вариантов развертывания, которые вы можете выбрать для своего проекта.